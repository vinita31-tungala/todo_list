<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>To-Do List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: silver;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .card {
            margin: 10px 0;
            cursor: grab;
        }
        .dark-mode {
            background-color: #121212;
            color: white;
        }
        .dark-mode .card {
            background-color: #1e1e1e;
            color: white;
        }
        .dark-toggle {
            float: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-center">üìù My To-Do List</h2>
            <div>
                <button class="btn btn-secondary dark-toggle" onclick="toggleDarkMode()">üåô Toggle Dark Mode</button>
                <a href="/logout" class="btn btn-danger ms-2">Logout</a>
            </div>
        </div>

        <!-- Add Task Form -->
        <form method="POST" action="/add" class="input-group mb-3">
            <input type="text" name="text" class="form-control" placeholder="Add new task..." required />
            <input type="datetime-local" name="deadline" class="form-control" />
            <button type="submit" class="btn btn-primary">Add</button>
        </form>

        <!-- Filter Buttons -->
        <div class="btn-group mb-3">
            <a href="/?filter=all" class="btn btn-dark {% if current_filter == 'all' %}active{% endif %}">All</a>
            <a href="/?filter=pending" class="btn btn-warning {% if current_filter == 'pending' %}active{% endif %}">Pending</a>
            <a href="/?filter=completed" class="btn btn-success {% if current_filter == 'completed' %}active{% endif %}">Completed</a>
            <a href="/?filter=deleted" class="btn btn-danger {% if current_filter == 'deleted' %}active{% endif %}">Deleted</a>
        </div>

        <!-- Task Cards -->
        <div id="task-list">
            {% for todo in tasks %}
            <div class="card" data-id="{{ todo['id'] }}" draggable="true">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <form method="POST" action="/edit/{{ todo['id'] }}" class="d-flex w-100">
                        {% if todo['status'] == 'completed' %}
                        <input
                            class="form-control me-2"
                            name="edited_task"
                            value="{{ todo['text'] }}"
                            readonly
                            style="text-decoration: line-through;"
                        />
                        {% else %}
                        <input class="form-control me-2" name="edited_task" value="{{ todo['text'] }}" />
                        {% endif %}

                        {% if todo['deadline'] %}
                        <span class="badge bg-info text-dark me-2">‚è∞ {{ todo['deadline'] }}</span>
                        {% endif %}

                        {% if todo['status'] != 'deleted' %}
                        <a href="/complete/{{ todo['id'] }}" class="btn btn-success me-2">‚úÖ</a>
                        <button class="btn btn-info me-2" type="submit">‚úèÔ∏è</button>
                        <a href="/delete/{{ todo['id'] }}" class="btn btn-danger">üóëÔ∏è</a>
                        {% endif %}
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
        }

        // Load dark mode from localStorage
        window.onload = function () {
            if (localStorage.getItem("darkMode") === "true") {
                document.body.classList.add("dark-mode");
            }
        };

        // Drag-and-drop ordering
        const taskList = document.getElementById("task-list");
        let dragSrcEl = null;

        taskList.addEventListener("dragstart", function (e) {
            if (e.target.classList.contains("card")) {
                dragSrcEl = e.target;
                e.dataTransfer.effectAllowed = "move";
                e.dataTransfer.setData("text/html", e.target.outerHTML);
            }
        });

        taskList.addEventListener("dragover", function (e) {
            e.preventDefault();
        });

        taskList.addEventListener("drop", function (e) {
            e.preventDefault();
            if (e.target.closest(".card") && dragSrcEl !== e.target.closest(".card")) {
                const dropTarget = e.target.closest(".card");
                const draggedHTML = dragSrcEl.outerHTML;
                dragSrcEl.remove();
                dropTarget.insertAdjacentHTML("beforebegin", draggedHTML);
                updateOrder();
            }
        });

        function updateOrder() {
            const cards = document.querySelectorAll("#task-list .card");
            const order = Array.from(cards).map((card) => card.dataset.id);
            fetch("/update_positions", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ order }),
            });
        }
    </script>
</body>
</html>








